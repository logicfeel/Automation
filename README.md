# Automation 인스턴스 모듈

### 인스턴스 모듈 요구사항

1. 독립적 실행

2. 인스턴스 모듈 하위에 인스턴스 모듈 추가 가능하게
    - 하위에 인스턴스를 포함 : 오버라이딩 방식으로 교체

3. 설치 폴더 구조 및 파일명은 자유롭게 변경 가능하게

4. 고정 상수 필요
    - ${modulename} : 모듈명

5. 작업단계
    - 사전(pre) 인스톨 : package 기준으로 설정파일(json) 구성
    - 인스톨 : 실제 설치

6. 핸들바 연동 지원

7. 중복의 처리
    - 모듈과 모듈의 중복 : 설정의 _overlap  표시함

8. 공용 설정의 제공 : public = {} 
    - 모듈 기준의 공용 설정


### 인스턴스 모듈 구조

1. 설정파일
    - 기본(.setup) > 공용설정(public) > 전용설정
    - 템플릿 파일은 


### 기능

- 종속된 모듈과 인스턴스모듈 검색
    + 대상 모듈 검색

- i모듈의 preinstall
    + 모듈 : preinstall 실행후 결과 가져옴
    + i모듈 : 설정파일의 가져옴

- i모듈의 install
    + 설정파일 > 모듈의 install 후킹 처리 : 데이터, 메소드
        * [base 설정 *생략가능] + public 설정 + private 설정 넘김
            - 이미 가져왔으므로..

### 정의

- 모듈명에 "-" 있는 것은 종속 서브 모듈
    + 단독실행 : 문자로 구성 
        * 예> install, init, preinstall
    + 종속실행 : 문자 + "-" + 문자 

- MODULE_SCHEMA : gulp_module.json 구조 버전명

- MODULE_I_SCHEMA : gulp_i_module.json 구조 버전명


### 이슈

1. gulp.run() : 부분은 gulp 3.9 기준이며 제외 가능한 자동화여서 이후 대체 필요성 있음

### 구조 설계

#### init 태스크 설계
- 기본파일 가져와 초기화 & 배치 폴더 제거 

#### update 태스크 설계 
> dd

| package 모듈  | config  | node_module(설치)   | 설명  |
|:-------------:|:-------:|:------------------:|--------|
|  O  |  O  |  O  | `정상` |
|  O  |  O  |  X  | `오류 출력` |
|  O  |  X  |  O  | `update 추가 처리` mod기준  |
|  X  |  O  | 무시 | `config 제거` nod기준 |

> package 모듈은 다른 모듈이 포함되어 있음
> 1. 패키지 폴더 설치 검사
> 2. 모듈패키지 모듈 O & 

- 모듈 및 설정 검사
    - 패키지 종속 모듈 O, 설정 모듈 X : 추가
        + 대상 모듈 찾기 (초기화는 되어 있음) => 모듈 없을시 오류 출력, 버전검사?
            * 모듈별
                - `하위모듈:load-config` 태스크 실행
                - getConfig() 얻기 => 없을시 오류 출력
                - public와 가져온 설정 병합
                - 설정에 추가
            * i모듈
                - `하위i모듈:load-config` 태스크 실행  (i모듈용)
                - getConfig() 얻기 => 없을시 오류 출력
                - 설정에 추가
                - REVIEW: 
                    + 상위 public install 경로의 처리?
            * REVEIW: 구조 반영함
                - `하위모듈:default` 태스크의 preinstall 에 배치 여부
                 
    - 패키지 종속 모듈 X, 설정 모듈 O : 제거
        + 설정 정보 제거
- 모듈 모두 처리후 저장

#### preinstall 태스크 설계
> 이 과정을 반복하며 소스 테스트
> _install 제작/구성 됨

- 모듈 반복
    + 모듈
        * setConfig() 설정
        * `하위모듈:default` 태스크 실행
        * getConfig() 얻기 => 없을시 오류 출력
        * 배포폴더 조회 후 install 속성 얻기
        * 설정 교체 (_replace)
    + i모듈
        * setConfig() 설정 (모듈용)
        * `하위i모듈:preinstall` 태스크 실행
        *  ...서브루틴 ...
        * getConfig() 얻기 (모듈묭) => 없을시 오류 출력
        * 설정에 교체 (전체)
        - REVEIW:
            + i모듈 하위의 설치 폴더를 변경하고 싶을때..?

#### install 태스크 설계
> _install 수정하며 install 소스 테스트

- 중복 검사 (파일, 폴더)
- 모듈반복
    + 모듈 (소스맵 연동)
        * 배포폴더 src (대상)
        * 설치 폴더에 배포 
    + i모듈


### 설계 이슈

- 설정 파일 전달 후 저장 하는게 맞을지?        
